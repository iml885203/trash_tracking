# Integration Tests

æ•´åˆæ¸¬è©¦å¥—ä»¶ï¼Œæ¸¬è©¦ç³»çµ±å¾ä½¿ç”¨è€…è§’åº¦çš„åŠŸèƒ½ã€‚

## ğŸ“‹ æ¸¬è©¦ç¯„åœ

### P0 (å¿…é ˆ) - å·²å®Œæˆ âœ…

**Test Suite 1: CLI æŸ¥è©¢åŠŸèƒ½** (`test_cli_query.py`)
- âœ… ç”¨åœ°å€æŸ¥è©¢åƒåœ¾è»Š
- âœ… ç”¨åº§æ¨™æŸ¥è©¢åƒåœ¾è»Š
- âœ… æŒ‡å®šæœå°‹åŠå¾‘
- âœ… éæ¿¾ç‰¹å®šè·¯ç·š
- âœ… è‡ªè¨‚é¡¯ç¤ºé»æ•¸
- âœ… éŒ¯èª¤è™•ç†ï¼ˆç„¡æ•ˆåœ°å€ã€æ‰¾ä¸åˆ°åƒåœ¾è»Šï¼‰

**Test Suite 2: API ç‹€æ…‹æŸ¥è©¢** (`test_api_status.py`)
- âœ… GET /health (å¥åº·æª¢æŸ¥)
- âœ… GET /api/trash/status (æŸ¥è©¢ç‹€æ…‹)
- âœ… POST /api/reset (é‡ç½®è¿½è¹¤å™¨)
- âœ… API éŒ¯èª¤è™•ç†
- âœ… ä½µç™¼è«‹æ±‚è™•ç†

**Test Suite 3: è¨­å®šç²¾éˆ API** (`test_setup_wizard_api.py`)
- âœ… GET / æˆ– /setup (è¼‰å…¥è¨­å®šç²¾éˆé é¢)
- âœ… POST /api/setup/suggest (åˆ†æåœ°å€)
- âœ… POST /api/setup/save (å„²å­˜é…ç½®)
- âœ… éŒ¯èª¤è™•ç†ï¼ˆç„¡æ•ˆåœ°å€ã€ç¼ºå°‘åƒæ•¸ï¼‰
- âœ… UI å…ƒç´ æª¢æŸ¥

## ğŸš€ é‹è¡Œæ¸¬è©¦

### å‰ç½®éœ€æ±‚

```bash
# å®‰è£æ¸¬è©¦ä¾è³´
pip install pytest requests
```

### é‹è¡Œæ–¹å¼

#### 1. é‹è¡Œæ‰€æœ‰æ•´åˆæ¸¬è©¦

```bash
# å¾å°ˆæ¡ˆæ ¹ç›®éŒ„
pytest tests/integration/ -v
```

#### 2. é‹è¡Œç‰¹å®šæ¸¬è©¦å¥—ä»¶

```bash
# åªæ¸¬è©¦ CLI
pytest tests/integration/test_cli_query.py -v

# åªæ¸¬è©¦ API ç‹€æ…‹
pytest tests/integration/test_api_status.py -v

# åªæ¸¬è©¦è¨­å®šç²¾éˆ
pytest tests/integration/test_setup_wizard_api.py -v
```

#### 3. é‹è¡Œç‰¹å®šæ¸¬è©¦

```bash
# æ¸¬è©¦ç‰¹å®šåŠŸèƒ½
pytest tests/integration/test_cli_query.py::TestCLIQuery::test_query_by_address -v
```

### æ³¨æ„äº‹é …

âš ï¸ **API æ¸¬è©¦éœ€è¦å…ˆå•Ÿå‹• Flask ä¼ºæœå™¨**

```bash
# åœ¨å¦ä¸€å€‹çµ‚ç«¯æ©Ÿè¦–çª—å•Ÿå‹•
python3 app.py
```

å¦‚æœ API ä¼ºæœå™¨æœªå•Ÿå‹•ï¼ŒAPI ç›¸é—œæ¸¬è©¦æœƒè‡ªå‹•è·³éã€‚

## ğŸ“Š æ¸¬è©¦å ±å‘Š

### ç”¢ç”Ÿè©³ç´°å ±å‘Š

```bash
# ç”¢ç”Ÿ HTML å ±å‘Š
pytest tests/integration/ --html=report.html --self-contained-html

# ç”¢ç”Ÿè¦†è“‹ç‡å ±å‘Š
pytest tests/integration/ --cov=src --cov-report=html
```

## ğŸ¯ æ¸¬è©¦ç­–ç•¥

### CLI æ¸¬è©¦
- ä½¿ç”¨ `subprocess` åŸ·è¡Œå¯¦éš›çš„ CLI å‘½ä»¤
- é©—è­‰æ¨™æº–è¼¸å‡ºå’ŒéŒ¯èª¤è¼¸å‡º
- æª¢æŸ¥è¿”å›ç¢¼

### API æ¸¬è©¦
- ä½¿ç”¨ `requests` å‘¼å«å¯¦éš›çš„ API ç«¯é»
- éœ€è¦ Flask ä¼ºæœå™¨é‹è¡Œä¸­
- æ¸¬è©¦å®Œæ•´çš„ HTTP è«‹æ±‚/éŸ¿æ‡‰é€±æœŸ

### ç‰¹é»
- **çœŸå¯¦ç’°å¢ƒæ¸¬è©¦**: ä½¿ç”¨çœŸå¯¦çš„ NTPC API
- **ç«¯åˆ°ç«¯æ¸¬è©¦**: æ¸¬è©¦å®Œæ•´çš„ä½¿ç”¨è€…æµç¨‹
- **éŒ¯èª¤è™•ç†**: æ¸¬è©¦å„ç¨®éŒ¯èª¤æƒ…æ³

## â±ï¸ é æœŸåŸ·è¡Œæ™‚é–“

- CLI æ¸¬è©¦: ~30-60 ç§’ï¼ˆéœ€è¦å‘¼å«å¤–éƒ¨ APIï¼‰
- API æ¸¬è©¦: ~10-20 ç§’
- è¨­å®šç²¾éˆæ¸¬è©¦: ~30-60 ç§’ï¼ˆéœ€è¦å‘¼å«å¤–éƒ¨ APIï¼‰

**ç¸½è¨ˆ**: ç´„ 1-2 åˆ†é˜

## ğŸ› æ¸¬è©¦å¤±æ•—æ’æŸ¥

### CLI æ¸¬è©¦å¤±æ•—

1. æª¢æŸ¥ç¶²è·¯é€£ç·š
2. ç¢ºèª NTPC API å¯ç”¨
3. æª¢æŸ¥ `cli.py` è·¯å¾‘æ­£ç¢º

### API æ¸¬è©¦å¤±æ•—

1. ç¢ºèª Flask ä¼ºæœå™¨æ­£åœ¨é‹è¡Œ
2. æª¢æŸ¥ç«¯å£ 5000 æ˜¯å¦è¢«å ç”¨
3. æŸ¥çœ‹ä¼ºæœå™¨æ—¥èªŒ

### è¨­å®šç²¾éˆæ¸¬è©¦å¤±æ•—

1. ç¢ºèª Flask ä¼ºæœå™¨æ­£åœ¨é‹è¡Œ
2. æª¢æŸ¥ç¶²è·¯é€£ç·šï¼ˆéœ€è¦å‘¼å« APIï¼‰
3. ç¢ºèªåœ°ç†ç·¨ç¢¼æœå‹™å¯ç”¨

## ğŸ“ æ–°å¢æ¸¬è©¦

### æ¸¬è©¦å‘½åè¦ç¯„

```python
def test_<feature_name>_<scenario>():
    """Test description in English"""
    # æ¸¬è©¦é‚è¼¯
```

### æ¸¬è©¦çµæ§‹

```python
class TestFeatureName:
    """æ¸¬è©¦å¥—ä»¶åç¨±"""

    def test_happy_path(self):
        """æ¸¬è©¦æ­£å¸¸æµç¨‹"""
        pass

    def test_error_handling(self):
        """æ¸¬è©¦éŒ¯èª¤è™•ç†"""
        pass
```

## ğŸ”„ æŒçºŒæ•´åˆ

å»ºè­°åœ¨ CI/CD ä¸­é‹è¡Œé€™äº›æ¸¬è©¦ï¼š

```yaml
# .github/workflows/test.yml ç¯„ä¾‹
- name: Run Integration Tests
  run: |
    python3 app.py &
    sleep 5
    pytest tests/integration/ -v
    kill %1
```
