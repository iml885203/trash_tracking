# language: zh-TW
功能: 垃圾車追蹤狀態管理
  作為一個 Home Assistant 使用者
  我想要系統正確追蹤垃圾車狀態
  以便燈光自動化正確運作

  背景:
    假設 系統已設定追蹤路線 "三區晚9"
    而且 進入點是 "保平路177巷6弄2號"
    而且 離開點是 "保平路151巷3號"

  場景: 垃圾車到達進入點時觸發 nearby
    假設 垃圾車目前在進入點之前
    當 垃圾車到達進入點
    那麼 狀態應該變成 "nearby"

  場景: 垃圾車通過離開點後變成 idle
    假設 狀態目前是 "nearby"
    而且 垃圾車已通過離開點
    當 系統檢查垃圾車狀態
    那麼 狀態應該變成 "idle"

  場景: 垃圾車經過後不會再次觸發 nearby（防止狀態跳動）
    假設 垃圾車已經通過離開點
    而且 狀態目前是 "idle"
    當 系統再次檢查垃圾車狀態
    那麼 狀態應該維持 "idle"
    而且 不應該觸發狀態變更

  場景: API 資料跳過站點但有補回 arrival 資料
    假設 垃圾車從第 20 站跳到第 30 站
    而且 進入點在第 23 站
    而且 離開點在第 26 站
    而且 API 有補回進入點和離開點的 arrival 資料
    當 系統檢查垃圾車狀態
    那麼 狀態應該維持 "idle"
    而且 不應該因為進入點有 arrival 就觸發 nearby

  場景: Truck Info 從 API 開始就顯示位置
    假設 API 回傳垃圾車在第 25 站
    而且 進入點在第 23 站
    當 系統處理 API 回應
    那麼 Truck Info 應該顯示第 25 站的位置
    而且 不管狀態是 idle 或 nearby

  場景: Truck Info 不會在狀態切換時跳動
    假設 垃圾車資料持續可用
    當 狀態從 "nearby" 變成 "idle"
    那麼 Truck Info 應該持續顯示垃圾車位置
    而且 不應該變成 "No truck nearby"
