# ğŸ§ª Integration æ‰‹å‹•æ¸¬è©¦æŒ‡å—

**æ¸¬è©¦æ—¥æœŸ:** 2025-11-22
**Integration ç‰ˆæœ¬:** 1.0.0
**ç‹€æ…‹:** âœ… æº–å‚™å°±ç·’

---

## ğŸ“‹ æ¸¬è©¦å‰æº–å‚™

### å‰ç½®éœ€æ±‚
1. âœ… Home Assistant å·²å®‰è£ä¸¦é‹è¡Œ
2. âœ… åƒåœ¾è»Šè¿½è¹¤ Add-on å·²å®‰è£ä¸¦å•Ÿå‹•
3. âœ… Add-on API å¯åœ¨ `http://localhost:5000` å­˜å–
4. âœ… Add-on å·²å®ŒæˆåŸºæœ¬è¨­å®šï¼ˆåœ°å€ã€æ”¶é›†é»ç­‰ï¼‰

### é©—è­‰ Add-on é‹è¡Œ
```bash
# åœ¨ Home Assistant ä¸­åŸ·è¡Œ
curl http://localhost:5000/health

# æ‡‰è©²çœ‹åˆ°é¡ä¼¼å›æ‡‰ï¼š
# {
#   "status": "ok",
#   "timestamp": "2025-11-22T...",
#   "config": {...}
# }
```

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### æ­¥é©Ÿ 1: è¤‡è£½ Integration åˆ° Home Assistant

```bash
# æ–¹æ³• A: å¦‚æœåœ¨åŒä¸€å°æ©Ÿå™¨
cp -r /home/dodoro/dev/trash_tracking/custom_components/trash_tracking \
      /config/custom_components/

# æ–¹æ³• B: å¦‚æœéœ€è¦é ç«¯è¤‡è£½
scp -r /home/dodoro/dev/trash_tracking/custom_components/trash_tracking \
       user@homeassistant:/config/custom_components/
```

### æ­¥é©Ÿ 2: é‡å•Ÿ Home Assistant

```bash
# åœ¨ Home Assistant Terminal æˆ– SSH
ha core restart

# æˆ–åœ¨ UI ä¸­ï¼šè¨­å®š â†’ ç³»çµ± â†’ é‡æ–°å•Ÿå‹•
```

### æ­¥é©Ÿ 3: ç­‰å¾…é‡å•Ÿå®Œæˆ

- ç­‰å¾… 1-2 åˆ†é˜
- ç¢ºèªå¯ä»¥é‡æ–°ç™»å…¥ Home Assistant UI

---

## âœ… æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### éšæ®µ 1ï¸âƒ£: å®‰è£ Integration

- [ ] **1.1 æ‰¾åˆ° Integration**
  - é€²å…¥ï¼šè¨­å®š â†’ è£ç½®èˆ‡æœå‹™ â†’ å³ä¸‹è§’ã€Œ+ æ–°å¢æ•´åˆã€
  - æœå°‹ï¼š`Trash Tracking` æˆ– `åƒåœ¾è»Š`
  - âœ… æ‡‰è©²å‡ºç¾åœ¨æ¸…å–®ä¸­

- [ ] **1.2 é–‹å§‹è¨­å®š**
  - é»é¸ "Trash Tracking"
  - âœ… æ‡‰è©²é¡¯ç¤ºè¨­å®šå°è©±æ¡†

- [ ] **1.3 è¼¸å…¥ API URL**
  - è¼¸å…¥ï¼š`http://localhost:5000`
  - é»é¸ã€Œé€å‡ºã€
  - âœ… æ‡‰è©²æˆåŠŸé€£æ¥ï¼ˆå¦‚æœ Add-on æ­£åœ¨é‹è¡Œï¼‰
  - âŒ å¦‚æœå¤±æ•—ï¼Œæª¢æŸ¥éŒ¯èª¤è¨Šæ¯

- [ ] **1.4 å®Œæˆå®‰è£**
  - âœ… æ‡‰è©²é¡¯ç¤ºã€ŒæˆåŠŸæ–°å¢ Trash Trackingã€
  - âœ… æ‡‰è©²è‡ªå‹•è¿”å›ã€Œè£ç½®èˆ‡æœå‹™ã€é é¢
  - âœ… å¯ä»¥çœ‹åˆ°ã€ŒTrash Trackingã€å¡ç‰‡

---

### éšæ®µ 2ï¸âƒ£: é©—è­‰å¯¦é«”å»ºç«‹

- [ ] **2.1 æª¢æŸ¥å¯¦é«”æ¸…å–®**
  - é»é¸ã€ŒTrash Trackingã€å¡ç‰‡
  - é»é¸ã€ŒN å€‹å¯¦é«”ã€é€£çµ
  - âœ… æ‡‰è©²çœ‹åˆ° 3 å€‹å¯¦é«”ï¼š

    | å¯¦é«” ID | åç¨± | é¡å‹ | é æœŸç‹€æ…‹ |
    |---------|------|------|----------|
    | `sensor.trash_tracking_status` | Trash Tracking Status | sensor | idle/nearby |
    | `sensor.trash_tracking_truck_info` | Trash Tracking Truck Info | sensor | unknown/è·¯ç·šåç¨± |
    | `binary_sensor.trash_truck_nearby` | Trash Truck Nearby | binary_sensor | off/on |

- [ ] **2.2 æª¢æŸ¥å¯¦é«”æ­¸å±¬**
  - é»é¸ä»»ä¸€å¯¦é«”
  - é»é¸ã€Œè£ç½®ã€é€£çµ
  - âœ… æ‡‰è©²çœ‹åˆ°è£ç½®åç¨±ï¼š`Trash Tracking (localhost:5000)`
  - âœ… 3 å€‹å¯¦é«”éƒ½æ‡‰è©²æ­¸å±¬æ–¼åŒä¸€å€‹è£ç½®

- [ ] **2.3 æª¢æŸ¥å¯¦é«”åœ–æ¨™**
  - âœ… `sensor.trash_tracking_status` â†’ ğŸ—‘ï¸ (mdi:delete)
  - âœ… `sensor.trash_tracking_truck_info` â†’ ğŸš› (mdi:truck)
  - âœ… `binary_sensor.trash_truck_nearby` â†’ ç›®æ¨™åœ–æ¨™ (presence)

---

### éšæ®µ 3ï¸âƒ£: é©—è­‰è³‡æ–™æ›´æ–°

- [ ] **3.1 åˆå§‹ç‹€æ…‹æª¢æŸ¥**
  - æŸ¥çœ‹ `sensor.trash_tracking_status`
  - âœ… æ‡‰è©²é¡¯ç¤ºç•¶å‰ Add-on çš„ç‹€æ…‹ï¼ˆidle æˆ– nearbyï¼‰
  - é»é¸å¯¦é«”æŸ¥çœ‹å±¬æ€§
  - âœ… æ‡‰è©²åŒ…å«ï¼š
    - `reason`: åŸå› èªªæ˜
    - `timestamp`: æ™‚é–“æˆ³è¨˜
    - å¦‚æœæ˜¯ nearbyï¼šé‚„æœ‰ `line_name`, `car_no` ç­‰

- [ ] **3.2 ç­‰å¾…è‡ªå‹•æ›´æ–°**
  - ç­‰å¾… 90 ç§’ï¼ˆé è¨­æƒæé–“éš”ï¼‰
  - é‡æ–°æ•´ç†é é¢
  - âœ… `last_updated` æ™‚é–“æ‡‰è©²æ›´æ–°

- [ ] **3.3 æ‰‹å‹•è§¸ç™¼æ›´æ–°**
  - é»é¸å¯¦é«”
  - é»é¸å³ä¸Šè§’ã€Œâ‹®ã€â†’ã€Œæ›´æ–°å¯¦é«”ã€
  - âœ… æ‡‰è©²ç«‹å³æ›´æ–°è³‡æ–™

---

### éšæ®µ 4ï¸âƒ£: æ¸¬è©¦ç‹€æ…‹è®ŠåŒ–ï¼ˆéœ€è¦å¯¦éš›åƒåœ¾è»Šï¼‰

å¦‚æœæœ‰åƒåœ¾è»Šæ¥è¿‘ï¼Œæ¸¬è©¦ç‹€æ…‹è®ŠåŒ–ï¼š

- [ ] **4.1 åƒåœ¾è»Šæ¥è¿‘æ™‚**
  - Add-on ç‹€æ…‹è®Šç‚º `nearby`
  - ç­‰å¾…æœ€å¤š 90 ç§’
  - âœ… `sensor.trash_tracking_status` â†’ `nearby`
  - âœ… `binary_sensor.trash_truck_nearby` â†’ `on`
  - âœ… å±¬æ€§åŒ…å«åƒåœ¾è»Šè³‡è¨Šï¼ˆè·¯ç·šã€è»Šç‰Œç­‰ï¼‰

- [ ] **4.2 åƒåœ¾è»Šé›¢é–‹æ™‚**
  - Add-on ç‹€æ…‹è®Šç‚º `idle`
  - ç­‰å¾…æœ€å¤š 90 ç§’
  - âœ… `sensor.trash_tracking_status` â†’ `idle`
  - âœ… `binary_sensor.trash_truck_nearby` â†’ `off`
  - âœ… å±¬æ€§æ¸…ç©ºï¼ˆåªå‰© reason å’Œ timestampï¼‰

---

### éšæ®µ 5ï¸âƒ£: æ¸¬è©¦ Options Flow

- [ ] **5.1 é–‹å•Ÿè¨­å®šé¸é …**
  - é€²å…¥ï¼šè¨­å®š â†’ è£ç½®èˆ‡æœå‹™
  - æ‰¾åˆ°ã€ŒTrash Trackingã€
  - é»é¸ã€Œè¨­å®šã€æŒ‰éˆ•
  - âœ… æ‡‰è©²é¡¯ç¤ºé¸é …å°è©±æ¡†

- [ ] **5.2 ä¿®æ”¹æƒæé–“éš”**
  - é è¨­å€¼ï¼š90 ç§’
  - æ”¹ç‚ºï¼š60 ç§’
  - é»é¸ã€Œé€å‡ºã€
  - âœ… æ‡‰è©²æˆåŠŸå„²å­˜

- [ ] **5.3 é©—è­‰æ–°é–“éš”ç”Ÿæ•ˆ**
  - è§€å¯Ÿå¯¦é«”çš„ `last_updated` æ™‚é–“
  - âœ… æ‡‰è©²æ¯ 60 ç§’æ›´æ–°ä¸€æ¬¡ï¼ˆè€Œé 90 ç§’ï¼‰

---

### éšæ®µ 6ï¸âƒ£: æ¸¬è©¦è‡ªå‹•åŒ–æ•´åˆ

- [ ] **6.1 å»ºç«‹æ¸¬è©¦è‡ªå‹•åŒ–**
  - é€²å…¥ï¼šè¨­å®š â†’ è‡ªå‹•åŒ–èˆ‡å ´æ™¯ â†’ å»ºç«‹è‡ªå‹•åŒ–
  - è§¸ç™¼æ¢ä»¶ï¼š
    ```yaml
    trigger:
      - platform: state
        entity_id: binary_sensor.trash_truck_nearby
        to: 'on'
    ```
  - å‹•ä½œï¼šç™¼é€é€šçŸ¥
    ```yaml
    action:
      - service: notify.persistent_notification
        data:
          message: "åƒåœ¾è»Šä¾†äº†ï¼"
    ```

- [ ] **6.2 æ¸¬è©¦è‡ªå‹•åŒ–è§¸ç™¼**
  - ç­‰å¾…åƒåœ¾è»Šæ¥è¿‘ï¼ˆæˆ–æ‰‹å‹•ä¿®æ”¹ Add-on é…ç½®è§¸ç™¼ï¼‰
  - âœ… æ‡‰è©²æ”¶åˆ°é€šçŸ¥

- [ ] **6.3 ä½¿ç”¨å¯¦é«”å±¬æ€§**
  - ä¿®æ”¹é€šçŸ¥è¨Šæ¯ä½¿ç”¨æ¨¡æ¿ï¼š
    ```yaml
    message: "{{ state_attr('sensor.trash_tracking_status', 'line_name') }} åƒåœ¾è»Šä¾†äº†ï¼"
    ```
  - âœ… æ‡‰è©²é¡¯ç¤ºè·¯ç·šåç¨±

---

### éšæ®µ 7ï¸âƒ£: æ¸¬è©¦éŒ¯èª¤è™•ç†

- [ ] **7.1 åœæ­¢ Add-on**
  - åœ¨ã€Œå¢ç›Šé›†ã€é é¢åœæ­¢ Add-on
  - ç­‰å¾…æœ€å¤š 90 ç§’
  - âœ… Integration å¯¦é«”æ‡‰è©²æ¨™è¨˜ç‚ºã€Œç„¡æ³•ä½¿ç”¨ã€
  - âœ… æ—¥èªŒæ‡‰è©²è¨˜éŒ„é€£æ¥éŒ¯èª¤

- [ ] **7.2 é‡å•Ÿ Add-on**
  - é‡æ–°å•Ÿå‹• Add-on
  - ç­‰å¾… Add-on å®Œå…¨å•Ÿå‹•
  - ç­‰å¾…æœ€å¤š 90 ç§’
  - âœ… Integration å¯¦é«”æ‡‰è©²è‡ªå‹•æ¢å¾©
  - âœ… å¯¦é«”ç‹€æ…‹æ‡‰è©²æ›´æ–°

---

### éšæ®µ 8ï¸âƒ£: æ¸¬è©¦å¤šèªè¨€

- [ ] **8.1 åˆ‡æ›èªè¨€**
  - é€²å…¥ï¼šå€‹äººè³‡æ–™ â†’ èªè¨€
  - åˆ‡æ›ç‚ºã€ŒEnglishã€
  - âœ… Integration åç¨±æ‡‰è©²é¡¯ç¤ºç‚º "Trash Tracking"
  - âœ… å¯¦é«”åç¨±æ‡‰è©²æ˜¯è‹±æ–‡

- [ ] **8.2 åˆ‡æ›å›ä¸­æ–‡**
  - åˆ‡æ›ç‚ºã€Œç¹é«”ä¸­æ–‡ã€
  - âœ… æ‡‰è©²é¡¯ç¤ºä¸­æ–‡ç¿»è­¯

---

### éšæ®µ 9ï¸âƒ£: æ¸¬è©¦èˆ‡ Add-on å…±å­˜

- [ ] **9.1 ç¢ºèª Add-on åŠŸèƒ½ä¸å—å½±éŸ¿**
  - è¨ªå• Add-on çš„ Ingress é é¢
  - âœ… Setup Wizard æ‡‰è©²æ­£å¸¸é‹ä½œ
  - âœ… å¯ä»¥ä¿®æ”¹é…ç½®
  - âœ… å¯ä»¥æŸ¥è©¢åƒåœ¾è»Š

- [ ] **9.2 ç¢ºèªå‚³çµ± RESTful Sensor å¯ç”¨**
  - å¦‚æœæœ‰è¨­å®š RESTful sensor
  - âœ… æ‡‰è©²èˆ‡ Integration åŒæ™‚é‹ä½œ
  - âœ… è³‡æ–™æ‡‰è©²ä¸€è‡´

- [ ] **9.3 è³‡æ–™ä¸€è‡´æ€§**
  - æ¯”è¼ƒï¼š
    - RESTful sensor çš„ç‹€æ…‹
    - Integration sensor çš„ç‹€æ…‹
    - ç›´æ¥è¨ªå• Add-on API
  - âœ… ä¸‰è€…æ‡‰è©²å®Œå…¨ä¸€è‡´

---

### éšæ®µ ğŸ”Ÿ: æ¸¬è©¦ç§»é™¤

- [ ] **10.1 ç§»é™¤ Integration**
  - è¨­å®š â†’ è£ç½®èˆ‡æœå‹™
  - æ‰¾åˆ°ã€ŒTrash Trackingã€
  - é»é¸ã€Œâ‹®ã€â†’ã€Œåˆªé™¤ã€
  - ç¢ºèªåˆªé™¤
  - âœ… Integration æ‡‰è©²è¢«ç§»é™¤
  - âœ… æ‰€æœ‰å¯¦é«”æ‡‰è©²æ¶ˆå¤±

- [ ] **10.2 ç¢ºèª Add-on ä¸å—å½±éŸ¿**
  - âœ… Add-on æ‡‰è©²ç¹¼çºŒé‹è¡Œ
  - âœ… Add-on API æ‡‰è©²ä»ç„¶å¯ç”¨
  - âœ… Setup Wizard æ‡‰è©²ä»ç„¶å¯ç”¨

---

## ğŸ› å¸¸è¦‹å•é¡Œæ’æŸ¥

### å•é¡Œ 1: æ‰¾ä¸åˆ° Integration

**ç—‡ç‹€:** åœ¨ã€Œæ–°å¢æ•´åˆã€ä¸­æœå°‹ä¸åˆ° "Trash Tracking"

**è§£æ±ºæ–¹æ³•:**
```bash
# æª¢æŸ¥æª”æ¡ˆæ˜¯å¦è¤‡è£½æ­£ç¢º
ls -la /config/custom_components/trash_tracking/

# æ‡‰è©²çœ‹åˆ°ï¼š
# manifest.json
# __init__.py
# config_flow.py
# ... ç­‰æª”æ¡ˆ

# æª¢æŸ¥æ—¥èªŒ
cat /config/home-assistant.log | grep trash_tracking

# é‡å•Ÿ Home Assistant
ha core restart
```

---

### å•é¡Œ 2: é€£æ¥ API å¤±æ•—

**ç—‡ç‹€:** è¨­å®šæ™‚é¡¯ç¤ºã€Œç„¡æ³•é€£æ¥åˆ° APIã€

**è§£æ±ºæ–¹æ³•:**
```bash
# 1. ç¢ºèª Add-on æ­£åœ¨é‹è¡Œ
ha addons info addon_*_trash_tracking

# 2. æ¸¬è©¦ API é€£æ¥
curl http://localhost:5000/health

# 3. æª¢æŸ¥ Add-on æ—¥èªŒ
ha addons logs addon_*_trash_tracking

# 4. å˜—è©¦ä½¿ç”¨å®Œæ•´ URL
# åœ¨è¨­å®šæ™‚è¼¸å…¥: http://localhost:5000
# æˆ–: http://homeassistant.local:5000
```

---

### å•é¡Œ 3: å¯¦é«”ä¸æ›´æ–°

**ç—‡ç‹€:** å¯¦é«”å»ºç«‹äº†ä½†ç‹€æ…‹ä¸æ›´æ–°

**è§£æ±ºæ–¹æ³•:**
```bash
# æª¢æŸ¥ Integration æ—¥èªŒ
cat /config/home-assistant.log | grep "trash_tracking"

# æ‰‹å‹•è§¸ç™¼æ›´æ–°
# åœ¨ UI ä¸­: å¯¦é«” â†’ â‹® â†’ æ›´æ–°å¯¦é«”

# æª¢æŸ¥æƒæé–“éš”è¨­å®š
# è¨­å®š â†’ è£ç½®èˆ‡æœå‹™ â†’ Trash Tracking â†’ è¨­å®š
```

---

### å•é¡Œ 4: å¯¦é«”é¡¯ç¤ºã€Œç„¡æ³•ä½¿ç”¨ã€

**å¯èƒ½åŸå› :**
1. Add-on åœæ­¢é‹è¡Œ
2. API URL éŒ¯èª¤
3. ç¶²è·¯é€£æ¥å•é¡Œ

**è§£æ±ºæ–¹æ³•:**
```bash
# ç¢ºèª Add-on ç‹€æ…‹
ha addons info addon_*_trash_tracking | grep state

# æ‡‰è©²é¡¯ç¤º: state: started

# æ¸¬è©¦ API
curl http://localhost:5000/api/trash/status

# é‡å•Ÿ Integration
# è¨­å®š â†’ è£ç½®èˆ‡æœå‹™ â†’ Trash Tracking â†’ é‡æ–°è¼‰å…¥
```

---

## ğŸ“Š æ¸¬è©¦çµæœè¨˜éŒ„

### æ¸¬è©¦ç’°å¢ƒ
- Home Assistant ç‰ˆæœ¬: _____________
- Add-on ç‰ˆæœ¬: _____________
- æ¸¬è©¦æ—¥æœŸ: _____________

### æ¸¬è©¦çµæœ

| éšæ®µ | é …ç›® | é€šé | å¤±æ•— | å‚™è¨» |
|------|------|------|------|------|
| 1ï¸âƒ£ | å®‰è£ Integration | â˜ | â˜ | |
| 2ï¸âƒ£ | é©—è­‰å¯¦é«”å»ºç«‹ | â˜ | â˜ | |
| 3ï¸âƒ£ | é©—è­‰è³‡æ–™æ›´æ–° | â˜ | â˜ | |
| 4ï¸âƒ£ | æ¸¬è©¦ç‹€æ…‹è®ŠåŒ– | â˜ | â˜ | |
| 5ï¸âƒ£ | æ¸¬è©¦ Options Flow | â˜ | â˜ | |
| 6ï¸âƒ£ | æ¸¬è©¦è‡ªå‹•åŒ–æ•´åˆ | â˜ | â˜ | |
| 7ï¸âƒ£ | æ¸¬è©¦éŒ¯èª¤è™•ç† | â˜ | â˜ | |
| 8ï¸âƒ£ | æ¸¬è©¦å¤šèªè¨€ | â˜ | â˜ | |
| 9ï¸âƒ£ | æ¸¬è©¦èˆ‡ Add-on å…±å­˜ | â˜ | â˜ | |
| ğŸ”Ÿ | æ¸¬è©¦ç§»é™¤ | â˜ | â˜ | |

### ç™¼ç¾çš„å•é¡Œ

1. **å•é¡Œæè¿°:**
   - é‡ç¾æ­¥é©Ÿ:
   - éŒ¯èª¤è¨Šæ¯:
   - è§£æ±ºæ–¹æ¡ˆ:

2. **å•é¡Œæè¿°:**
   - é‡ç¾æ­¥é©Ÿ:
   - éŒ¯èª¤è¨Šæ¯:
   - è§£æ±ºæ–¹æ¡ˆ:

---

## âœ… æ¸¬è©¦å®Œæˆå¾Œ

### å¦‚æœæ¸¬è©¦æˆåŠŸ
- [ ] æ›´æ–° README.md èªªæ˜ Integration å¯ç”¨
- [ ] å»ºç«‹ GitHub Release (tag: integration-v1.0.0)
- [ ] æº–å‚™æäº¤åˆ° HACS
- [ ] æ’°å¯«ä½¿ç”¨è€…æŒ‡å—

### å¦‚æœç™¼ç¾å•é¡Œ
- [ ] è¨˜éŒ„æ‰€æœ‰å•é¡Œå’ŒéŒ¯èª¤è¨Šæ¯
- [ ] å›å ±çµ¦é–‹ç™¼è€…ä¿®å¾©
- [ ] ä¿®å¾©å¾Œé‡æ–°æ¸¬è©¦

---

**æ¸¬è©¦è€…:** _______________
**ç°½å:** _______________
**æ—¥æœŸ:** _______________
